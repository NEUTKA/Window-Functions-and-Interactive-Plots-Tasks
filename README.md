# Урок 6: Оконные функции и интерактивные графики

## Описание

Этот урок направлен на изучение динамики цен на авокадо и анализа данных об опозданиях в заключении сделок с использованием оконных функций и интерактивных визуализаций. Мы рассмотрим, как применять скользящие и экспоненциальные средние, а также научимся работать с временными интервалами в данных.

## Описание данных

Данные содержат информацию о ценах и объемах продаж авокадо в США, предоставленные Hass Avocado Board, а также данные об опозданиях при заключении сделок.

### Данные об авокадо
- **Date**: Дата наблюдения
- **AveragePrice**: Средняя цена одного авокадо
- **Total Volume**: Общее количество проданных авокадо
- **4046**: Количество проданных авокадо PLU 4046
- **4225**: Количество проданных авокадо PLU 4225
- **4770**: Количество проданных авокадо PLU 4770
- **Total Bags**: Общее количество упаковок
- **Small Bags**: Количество маленьких упаковок
- **Large Bags**: Количество больших упаковок
- **XLarge Bags**: Количество очень больших упаковок
- **type**: Тип авокадо (обычный или органический)
- **year**: Год наблюдения
- **Region**: Город или регион

### Данные по сделкам
- **client_id**: Идентификатор клиента
- **company_id**: Идентификатор компании
- **delay**: Задержка заключения сделки (в днях)
- **revenue**: Выручка от сделки

## Задачи

1. **Скользящее среднее**  
   Рассчитайте скользящее среднее цены авокадо (`AveragePrice`) с окном, равным 3. Найдите максимальное значение и округлите результат до двух знаков после запятой.

2. **Анализ зависимости скользящего среднего от размера окна**  
   Постройте графики скользящего среднего для значений окна 2, 4, 10, 50. Оцените влияние размера окна на график и соотнесите его с изображениями.

3. **Изучение документации**  
   Ознакомьтесь с параметрами функции в документации и соотнесите их с описанием.

4. **Экспоненциальное скользящее среднее**  
   Примените функцию `ewm()` с параметром `span=2` к средним ценам на авокадо и запишите результат в `avocado_ewm`.

5. **Анализ данных для органического авокадо в Чикаго**  
   Импортируйте данные, указав `index_col=0`. Для органического авокадо (`type='organic'`) в Чикаго (`region='Chicago'`) рассчитайте скользящее среднее с окном 4 и экспоненциальное скользящее среднее с параметром `span=4`. Постройте графики и округлите результаты до трех знаков после запятой.

6. **Преобразование данных по опозданиям в сделках**  
   Прочитайте данные по сделкам и переведите `delay` в формат `timedelta`, убрав знак `-`.

7. **Категоризация времени задержек**  
   Разделите колонку с задержками на 3 интервала и поместите значения в новую колонку `delay_categorical`.

8. **Перезадание категорий задержек**  
   Используя `pd.cut`, присвойте категории следующие значения:
   - `'less than 1 day'` для задержек от 0 до 1 дня
   - `'1-2 days'` для задержек от 1 до 2 дней
   - `'2-3 days'` для задержек от 2 до 3 дней
   - `'more than 3 days'` для задержек свыше 3 дней

9. **Интерактивный график частоты задержек**  
   Постройте интерактивный барплот, отражающий частоту задержек в заключении сделок, отсортировав категории по частоте от самой редкой (внизу) к самой частой (вверху).

---

Этот урок включает практическую работу с оконными функциями и визуализациями, что позволяет углубить понимание временных данных и их применения в анализе.
